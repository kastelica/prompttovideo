{% extends "base.html" %}

{% block title %}User Profile - PromptToVideo{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 dark:from-dark-900 dark:to-dark-800 py-8">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- Loading Spinner -->
        <div id="loadingSpinner" class="text-center py-16">
            <div class="animate-spin rounded-full h-16 w-16 border-4 border-primary border-t-transparent mx-auto mb-6"></div>
            <p class="text-gray-600 dark:text-gray-400 text-lg">Loading profile...</p>
        </div>
        
        <!-- Profile Container -->
        <div id="profileContainer" class="hidden">
            <!-- Profile Header -->
            <div class="bg-white dark:bg-dark-800 rounded-2xl shadow-xl p-8 mb-8 border border-gray-100 dark:border-dark-700">
                <div class="flex flex-col lg:flex-row items-start space-y-6 lg:space-y-0 lg:space-x-8">
                    <!-- Avatar Section -->
                    <div class="flex-shrink-0">
                        <div class="w-32 h-32 bg-gradient-to-br from-primary to-secondary text-white rounded-full flex items-center justify-center text-4xl font-bold shadow-lg" id="userAvatar">
                            U
                        </div>
                    </div>
                    
                    <!-- Profile Info -->
                    <div class="flex-1 min-w-0">
                        <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between mb-6">
                            <div class="mb-4 lg:mb-0">
                                <h1 id="displayName" class="text-3xl font-bold text-gray-900 dark:text-gray-100 mb-2">Loading...</h1>
                                <p id="username" class="text-lg text-gray-600 dark:text-gray-400">@username</p>
                            </div>
                            
                            <!-- Actions -->
                            <div class="flex flex-wrap gap-3">
                                <button id="followBtn" onclick="toggleFollow()" class="hidden px-6 py-3 bg-gradient-to-r from-primary to-secondary text-white rounded-xl hover:from-secondary hover:to-primary transition-all duration-200 font-semibold shadow-lg hover:shadow-xl transform hover:-translate-y-0.5">
                                    Follow
                                </button>
                                <button id="editBtn" onclick="editProfile()" class="hidden px-6 py-3 border-2 border-gray-300 dark:border-dark-600 text-gray-700 dark:text-gray-300 rounded-xl hover:bg-gray-50 dark:hover:bg-dark-700 hover:border-primary transition-all duration-200 font-semibold">
                                    Edit Profile
                                </button>
                                <a href="/settings" id="settingsBtn" class="hidden px-6 py-3 border-2 border-gray-300 dark:border-dark-600 text-gray-700 dark:text-gray-300 rounded-xl hover:bg-gray-50 dark:hover:bg-dark-700 hover:border-primary transition-all duration-200 font-semibold">
                                    Settings
                                </a>
                            </div>
                        </div>
                        
                        <!-- Bio -->
                        <div class="mb-6">
                            <p id="userBio" class="text-gray-700 dark:text-gray-300 text-lg leading-relaxed"></p>
                        </div>
                        
                        <!-- Profile Details -->
                        <div class="flex flex-wrap gap-6 text-sm text-gray-600 dark:text-gray-400 mb-6">
                            <div id="userLocation" class="hidden flex items-center bg-gray-50 dark:bg-dark-700 px-4 py-2 rounded-lg">
                                <svg class="w-5 h-5 mr-2 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                </svg>
                                <span class="font-medium"></span>
                            </div>
                            <div id="userWebsite" class="hidden">
                                <a href="#" target="_blank" class="text-primary hover:text-secondary flex items-center bg-gray-50 dark:bg-dark-700 px-4 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-dark-600 transition-colors">
                                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.102m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"></path>
                                    </svg>
                                    <span class="font-medium"></span>
                                </a>
                            </div>
                        </div>
                        
                        <!-- Stats Cards -->
                        <div class="grid grid-cols-2 lg:grid-cols-4 gap-4">
                            <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl p-4 text-center border border-blue-200">
                                <div id="totalVideos" class="text-2xl font-bold text-blue-700 mb-1">0</div>
                                <div class="text-sm text-blue-600 font-medium">Videos</div>
                            </div>
                            <div class="bg-gradient-to-br from-green-50 to-green-100 rounded-xl p-4 text-center border border-green-200">
                                <div id="totalViews" class="text-2xl font-bold text-green-700 mb-1">0</div>
                                <div class="text-sm text-green-600 font-medium">Views</div>
                            </div>
                            <div class="bg-gradient-to-br from-purple-50 to-purple-100 rounded-xl p-4 text-center border border-purple-200">
                                <div id="followerCount" class="text-2xl font-bold text-purple-700 mb-1">0</div>
                                <div class="text-sm text-purple-600 font-medium">Followers</div>
                            </div>
                            <div class="bg-gradient-to-br from-orange-50 to-orange-100 rounded-xl p-4 text-center border border-orange-200">
                                <div id="followingCount" class="text-2xl font-bold text-orange-700 mb-1">0</div>
                                <div class="text-sm text-orange-600 font-medium">Following</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Content Tabs -->
            <div class="bg-white dark:bg-dark-800 rounded-2xl shadow-xl border border-gray-100 dark:border-dark-700 overflow-hidden">
                <div class="border-b border-gray-200 dark:border-dark-700 bg-gradient-to-r from-gray-50 to-gray-100 dark:from-dark-700 dark:to-dark-600">
                    <nav class="flex space-x-1 px-8" aria-label="Tabs">
                        <button onclick="setActiveTab('videos')" class="tab-btn active" data-tab="videos">
                            <div class="flex items-center">
                                <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                                </svg>
                                <span class="font-semibold">Videos</span>
                                <span id="videosCount" class="ml-3 text-xs bg-primary text-white px-3 py-1 rounded-full font-bold shadow-sm">0</span>
                            </div>
                        </button>
                        <button onclick="setActiveTab('challenges')" class="tab-btn" data-tab="challenges">
                            <div class="flex items-center">
                                <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                <span class="font-semibold">Challenge Submissions</span>
                                <span id="submissionsCount" class="ml-3 text-xs bg-secondary text-white px-3 py-1 rounded-full font-bold shadow-sm">0</span>
                            </div>
                        </button>
                    </nav>
                </div>
                
                <!-- Tab Content -->
                <div class="p-8">
                    <!-- Videos Tab -->
                    <div id="videosTab" class="tab-content">
                        <div id="editNote" class="mb-4 text-sm text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/20 rounded-lg px-4 py-2 border border-blue-200 dark:border-blue-800 hidden">You can edit your videos here. Click the edit button on any video card.</div>
                        <div id="userVideos" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            <!-- Videos will be populated here -->
                        </div>
                        <div id="noVideos" class="text-center py-16 hidden">
                            <div class="bg-gray-50 dark:bg-dark-700 rounded-full w-24 h-24 flex items-center justify-center mx-auto mb-6">
                                <svg class="w-12 h-12 text-gray-400 dark:text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                                </svg>
                            </div>
                            <h3 class="text-xl font-semibold text-gray-900 dark:text-gray-100 mb-3">No videos yet</h3>
                            <p class="text-gray-600 dark:text-gray-400 mb-6">Start creating amazing videos to showcase your creativity!</p>
                            <a href="/" class="inline-flex items-center px-6 py-3 bg-gradient-to-r from-primary to-secondary text-white rounded-xl hover:from-secondary hover:to-primary transition-all duration-200 font-semibold shadow-lg hover:shadow-xl transform hover:-translate-y-0.5">
                                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                </svg>
                                Create Your First Video
                            </a>
                        </div>
                    </div>
                    
                    <!-- Challenges Tab -->
                    <div id="challengesTab" class="tab-content hidden">
                        <div id="userSubmissions" class="space-y-6">
                            <!-- Challenge submissions will be populated here -->
                        </div>
                        <div id="noSubmissions" class="text-center py-16 hidden">
                            <div class="bg-gray-50 dark:bg-dark-700 rounded-full w-24 h-24 flex items-center justify-center mx-auto mb-6">
                                <svg class="w-12 h-12 text-gray-400 dark:text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                            </div>
                            <h3 class="text-xl font-semibold text-gray-900 dark:text-gray-100 mb-3">No challenge submissions</h3>
                            <p class="text-gray-600 dark:text-gray-400 mb-6">Participate in community challenges to showcase your creativity!</p>
                            <a href="/challenges" class="inline-flex items-center px-6 py-3 bg-gradient-to-r from-primary to-secondary text-white rounded-xl hover:from-secondary hover:to-primary transition-all duration-200 font-semibold shadow-lg hover:shadow-xl transform hover:-translate-y-0.5">
                                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                Browse Challenges
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Error Message -->
        <div id="errorMessage" class="hidden text-center py-16">
            <div class="bg-red-50 dark:bg-red-900/20 rounded-full w-24 h-24 flex items-center justify-center mx-auto mb-6">
                <svg class="w-12 h-12 text-red-400 dark:text-red-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.728-.833-2.498 0L4.316 15.5c-.77.833.192 2.5 1.732 2.5z"></path>
                </svg>
            </div>
            <h3 class="text-xl font-semibold text-gray-900 dark:text-gray-100 mb-3">Profile not found</h3>
            <p class="text-gray-600 dark:text-gray-400 mb-6">This user profile doesn't exist or is private.</p>
            <a href="/" class="inline-flex items-center px-6 py-3 bg-gradient-to-r from-primary to-secondary text-white rounded-xl hover:from-secondary hover:to-primary transition-all duration-200 font-semibold shadow-lg hover:shadow-xl transform hover:-translate-y-0.5">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
                </svg>
                Go Home
            </a>
        </div>
    </div>
</div>

<style>
.tab-btn {
    @apply py-8 px-6 border-b-4 border-transparent font-semibold text-base text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 hover:border-gray-300 dark:hover:border-gray-600 focus:outline-none focus:text-gray-800 dark:focus:text-gray-200 focus:border-gray-300 dark:focus:border-gray-600 transition-all duration-300 relative overflow-hidden;
}

.tab-btn::before {
    content: '';
    @apply absolute inset-0 bg-gradient-to-r from-primary/5 to-secondary/5 opacity-0 transition-opacity duration-300;
}

.tab-btn:hover::before {
    @apply opacity-100;
}

.tab-btn.active {
    @apply border-primary text-primary bg-white dark:bg-dark-800 rounded-t-xl shadow-lg transform -translate-y-1;
    background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
}

.dark .tab-btn.active {
    background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
}

.tab-btn.active::before {
    @apply opacity-100;
}

.tab-content {
    @apply block;
}

/* Enhanced tab content animations */
.tab-content {
    animation: fadeInUp 0.3s ease-out;
}

@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.tab-content.hidden {
    @apply hidden;
}

.line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}
</style>

<script>
let currentUserId = null;
let profileUserId = {% if user_id %}{{ user_id }}{% else %}null{% endif %};
let isOwnProfile = false;

document.addEventListener('DOMContentLoaded', function() {
    loadProfile();
    
    // Check for tab parameter in URL
    const urlParams = new URLSearchParams(window.location.search);
    const activeTab = urlParams.get('tab');
    if (activeTab === 'videos') {
        // Set videos tab as active after a short delay to ensure profile is loaded
        setTimeout(() => {
            setActiveTab('videos');
        }, 500);
    }
});

async function loadProfile() {
    try {
        // First get current user info
        const authToken = localStorage.getItem('auth_token');
        if (authToken) {
            const currentUserResponse = await fetch('/api/v1/auth/me', {
                headers: {
                    'Authorization': `Bearer ${authToken}`
                }
            });
            
            if (currentUserResponse.ok) {
                const currentUser = await currentUserResponse.json();
                currentUserId = currentUser.id;
                
                // If no profile user ID specified, show current user's profile
                if (!profileUserId) {
                    profileUserId = currentUserId;
                }
                
                isOwnProfile = (profileUserId === currentUserId);
            }
        }
        
        // If still no profile user ID, redirect to login
        if (!profileUserId) {
            window.location.href = '/auth/login-page';
            return;
        }
        
        // Load the profile
        const response = await fetch(`/api/v1/profile/${profileUserId}`, {
            headers: authToken ? {
                'Authorization': `Bearer ${authToken}`
            } : {}
        });
        
        if (response.ok) {
            const profile = await response.json();
            displayProfile(profile);
        } else {
            showError();
        }
    } catch (error) {
        console.error('Error loading profile:', error);
        showError();
    }
}

function displayProfile(profile) {
    // Hide loading, show profile
    document.getElementById('loadingSpinner').classList.add('hidden');
    document.getElementById('profileContainer').classList.remove('hidden');
    
    // Profile header
    document.getElementById('userAvatar').textContent = profile.display_name.charAt(0).toUpperCase();
    document.getElementById('displayName').textContent = profile.display_name;
    document.getElementById('username').textContent = `@${profile.display_name.toLowerCase().replace(/\s+/g, '')}`;
    
    // Bio
    if (profile.bio) {
        document.getElementById('userBio').textContent = profile.bio;
    } else {
        document.getElementById('userBio').textContent = 'No bio available.';
    }
    
    // Location
    if (profile.location) {
        const locationEl = document.getElementById('userLocation');
        locationEl.querySelector('span').textContent = profile.location;
        locationEl.classList.remove('hidden');
    }
    
    // Website
    if (profile.website_url) {
        const websiteEl = document.getElementById('userWebsite');
        const link = websiteEl.querySelector('a');
        link.href = profile.website_url;
        link.querySelector('span').textContent = profile.website_url;
        websiteEl.classList.remove('hidden');
    }
    
    // Stats
    document.getElementById('totalVideos').textContent = profile.total_videos || 0;
    document.getElementById('totalViews').textContent = (profile.total_views || 0).toLocaleString();
    document.getElementById('followerCount').textContent = profile.follower_count || 0;
    document.getElementById('followingCount').textContent = profile.following_count || 0;
    
    // Tab counts
    document.getElementById('videosCount').textContent = (profile.videos || []).length;
    document.getElementById('submissionsCount').textContent = (profile.challenge_submissions || []).length;
    
    // Show appropriate buttons
    if (isOwnProfile) {
        document.getElementById('editBtn').classList.remove('hidden');
        document.getElementById('settingsBtn').classList.remove('hidden');
        document.getElementById('editNote').classList.remove('hidden');
    } else {
        document.getElementById('followBtn').classList.remove('hidden');
    }
    
    // Display content
    displayVideos(profile.videos || []);
    displaySubmissions(profile.challenge_submissions || []);
}

function displayVideos(videos) {
    const container = document.getElementById('userVideos');
    const noVideos = document.getElementById('noVideos');
    
    if (videos.length === 0) {
        noVideos.classList.remove('hidden');
        return;
    }
    
    const html = videos.map(video => `
        <div class="bg-white dark:bg-dark-800 rounded-xl shadow-lg overflow-hidden hover:shadow-xl transition-all duration-300 transform hover:-translate-y-1 border border-gray-100 dark:border-dark-700">
            <div class="relative aspect-video bg-gray-200">
                ${video.thumbnail_url ? 
                    `<img src="${video.thumbnail_url}" alt="${video.title}" class="w-full h-full object-cover" style="display: block !important; visibility: visible !important; opacity: 1 !important; max-width: 100%; height: auto;">` :
                    `<div class="flex items-center justify-center h-full text-gray-400">
                        <svg class="w-12 h-12" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                        </svg>
                    </div>`
                }
                <div class="absolute inset-0 bg-black bg-opacity-0 hover:bg-opacity-20 transition-opacity cursor-pointer flex items-center justify-center"
                     onclick="window.open('/watch/${video.id}-${video.slug}', '_blank')">
                    <div class="bg-white dark:bg-dark-800 bg-opacity-90 rounded-full p-3 transform scale-75 opacity-0 hover:scale-100 hover:opacity-100 transition-all duration-200">
                        <svg class="w-6 h-6 text-gray-800 dark:text-gray-200 ml-1" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M8 5v14l11-7z"/>
                        </svg>
                    </div>
                </div>
            </div>
            <div class="p-6">
                <h3 class="font-semibold text-gray-900 dark:text-gray-100 mb-3 line-clamp-2 text-lg">${video.title}</h3>
                <div class="flex flex-wrap gap-4 items-center text-sm text-gray-500 dark:text-gray-400 mb-3">
                    <span><svg class="w-4 h-4 mr-1 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/></svg> ${video.views || 0} views</span>
                    <span><svg class="w-4 h-4 mr-1 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg> ${new Date(video.created_at).toLocaleDateString()}</span>
                    <span><svg class="w-4 h-4 mr-1 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 4V2a1 1 0 011-1h8a1 1 0 011 1v2m-9 0h10m-10 0a2 2 0 00-2 2v14a2 2 0 002 2h10a2 2 0 002-2V6a2 2 0 00-2-2"/></svg> ${video.quality || 'HD'}</span>
                    ${video.duration ? `<span><svg class="w-4 h-4 mr-1 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg> ${video.duration}s</span>` : ''}
                </div>
                ${isOwnProfile ? `<a href="/watch/${video.id}-${video.slug || 'video'}?edit=1" target="_blank" class="inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium"><svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/></svg>Edit</a>` : ''}
            </div>
        </div>
    `).join('');
    
    container.innerHTML = html;
}

function displaySubmissions(submissions) {
    const container = document.getElementById('userSubmissions');
    const noSubmissions = document.getElementById('noSubmissions');
    
    if (submissions.length === 0) {
        noSubmissions.classList.remove('hidden');
        return;
    }
    
    const html = submissions.map(submission => `
        <div class="bg-white dark:bg-dark-800 rounded-xl shadow-lg p-6 hover:shadow-xl transition-all duration-300 border border-gray-100 dark:border-dark-700">
            <div class="flex items-start space-x-6">
                <div class="w-20 h-20 bg-gradient-to-br from-purple-100 to-purple-200 rounded-lg flex items-center justify-center flex-shrink-0">
                    <svg class="w-8 h-8 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                </div>
                <div class="flex-1">
                    <div class="flex items-center justify-between mb-3">
                        <h4 class="font-semibold text-gray-900 dark:text-gray-100 text-lg">${submission.title}</h4>
                        ${submission.rank && submission.rank <= 3 ? `
                            <span class="text-2xl">${submission.rank === 1 ? '🥇' : submission.rank === 2 ? '🥈' : '🥉'}</span>
                        ` : ''}
                    </div>
                    ${submission.description ? `<p class="text-gray-600 dark:text-gray-400 mb-4 leading-relaxed">${submission.description}</p>` : ''}
                    <div class="flex items-center justify-between text-sm text-gray-500 dark:text-gray-400">
                        <span class="flex items-center">
                            <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                            </svg>
                            ${submission.vote_count} votes
                        </span>
                        <span class="flex items-center">
                            <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                            </svg>
                            ${new Date(submission.created_at).toLocaleDateString()}
                        </span>
                    </div>
                </div>
            </div>
        </div>
    `).join('');
    
    container.innerHTML = html;
}

function showError() {
    document.getElementById('loadingSpinner').classList.add('hidden');
    document.getElementById('errorMessage').classList.remove('hidden');
}

function setActiveTab(tabName) {
    // Update tab buttons
    document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
    
    // Update tab content
    document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.add('hidden');
    });
    document.getElementById(`${tabName}Tab`).classList.remove('hidden');
}

async function toggleFollow() {
    try {
        const response = await fetch(`/api/v1/follow/${profileUserId}`, {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${localStorage.getItem('auth_token')}`
            }
        });
        
        if (response.ok) {
            const data = await response.json();
            const btn = document.getElementById('followBtn');
            
            if (data.action === 'followed') {
                btn.textContent = 'Following';
                btn.classList.remove('from-primary', 'to-secondary', 'hover:from-secondary', 'hover:to-primary');
                btn.classList.add('from-gray-500', 'to-gray-600', 'hover:from-gray-600', 'hover:to-gray-700');
                
                // Update follower count
                const countEl = document.getElementById('followerCount');
                countEl.textContent = parseInt(countEl.textContent) + 1;
            } else {
                btn.textContent = 'Follow';
                btn.classList.remove('from-gray-500', 'to-gray-600', 'hover:from-gray-600', 'hover:to-gray-700');
                btn.classList.add('from-primary', 'to-secondary', 'hover:from-secondary', 'hover:to-primary');
                
                // Update follower count
                const countEl = document.getElementById('followerCount');
                countEl.textContent = parseInt(countEl.textContent) - 1;
            }
        }
    } catch (error) {
        console.error('Error toggling follow:', error);
    }
}

function editProfile() {
    // For now, redirect to settings
    window.location.href = '/settings';
}
</script>
{% endblock %}